import logging

import pytest

from game import Game
from tests.game.parse_utils import parse_cards, parse_players
from utils.strings import to_string

from .test_cases.one_pair_data import one_pair_1


class TestGameTieBreak:

    @pytest.fixture(autouse=True)
    def setup_and_teardown(self):
        # Setup phase
        logging.info("TestGame setup")
        self.game_instance: Game = Game(num_players=0, debug=True)

        # The yield keyword pauses the fixture here, allowing the test to run with the setup completed
        yield

        # Teardown phase - after yield
        logging.info("TestGame teardown")

    def test_one_pair_winner(self):

        players = parse_players(one_pair_1["Players"])

        for idx, player in enumerate(players):
            player.id = idx
            self.game_instance.players[idx] = player
        self.game_instance.board = parse_cards(one_pair_1["Board"])
        self.game_instance.get_board()
        winners = self.game_instance.find_winners()
        assert len(winners) == 1
        assert winners[0].id == "0"
        assert True
